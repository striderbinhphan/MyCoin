<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>BinhCoin</title>
		<!-- Description, Keywords and Author -->
		<meta name="description" content="Your description">
		<meta name="keywords" content="Your,Keywords">
		<meta name="author" content="HimanshuGupta">
		
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		
		<!-- Styles -->
		<!-- Bootstrap CSS -->
		<link href="css/bootstrap.min.css" rel="stylesheet">	
		<!-- Animate CSS -->
		<link href="css/animate.min.css" rel="stylesheet">
		<!-- Basic stylesheet -->
		<link rel="stylesheet" href="css/owl.carousel.css">
		<!-- Font awesome CSS -->
		<link href="css/font-awesome.min.css" rel="stylesheet">		
		<!-- Custom CSS -->
		<link href="css/style.css" rel="stylesheet">
		<link href="css/style-color.css" rel="stylesheet">
		<link href="css/hover.css" rel="stylesheet">
		<!-- Favicon -->
		<link rel="shortcut icon" href="img/logo/favicon.ico">
		<link rel="stylesheet" href="css/jquery.mCustomScrollbar.min.css" />
		<script src="js/FileSaver.js"></script>
	</head>
	
	<body>
		
		<!-- modal for booking ticket form -->
		<div class="modal fade" id="createwallet" tabindex="-1" role="dialog" aria-labelledby="createwallet">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="myModalLabel">Create wallet</h4>
					</div>
					<!-- form for events ticket booking -->
					<form>
						<div class="modal-body">
							<div class="form-group">
								<div class="button-options">
									<div class="item-select-custom">
										<div class="wallet-option-container">
											<div class="img-title-container">
												<div class="title-link-container">
													<span >Private Key</span>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="modal-footer">
							
							<button onclick="createWallet()" type="button" class="btn btn-success" data-dismiss="modal" data-target="#confirm-key">Generate KeyPair</button>
						</div>
					</form>
				</div>
			</div>
		</div>
		<div class="modal fade" id="accesswallet" tabindex="-1" role="dialog" aria-labelledby="accesswallet" aria-hidden="true">
			<div class="modal-dialog" role="document">
			  <div class="modal-content">
				<div class="modal-header">
				  <h5 class="modal-title" id="exampleModalLabel">Access Wallet</h5>
				  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				  </button>
				</div>
				<div class="modal-body">
				  <form>
					<div class="form-group">
					  <label for="private-key" class="col-form-label">Private Key:</label>
					  <input type="password" class="form-control" id="private-key" required>
					</div>
				  </form>
				</div>
				<div class="modal-footer">
					<button onclick="accessWallet()" class="the-button-box no-min-width"> Access Wallet</button>
				</div>
			  </div>
			</div>
		  </div>
			
		<!-- wrapper -->
		<div class="wrapper" id="home">
		
			<!-- header area -->
			<header>
				<!-- secondary menu -->
				<nav class="secondary-menu">
					<div class="container">
						<!-- secondary menu left link area -->
						<div class="sm-left">
							<strong>Phone</strong>:&nbsp; <a href="#">+8432864xxxx</a>&nbsp;&nbsp;&nbsp;&nbsp;
							<strong>E-mail</strong>:&nbsp; <a href="#">pipporkk@gmail.com</a>
						</div>
						<!-- secondary menu right link area -->
						<div class="sm-right">
							<!-- social link -->
							<div class="sm-social-link">
								<a class="h-facebook" href="#"><i class="fa fa-facebook"></i></a>
								<a class="h-twitter" href="#"><i class="fa fa-twitter"></i></a>
								<a class="h-google" href="#"><i class="fa fa-google-plus"></i></a>
								<a class="h-linkedin" href="#"><i class="fa fa-linkedin"></i></a>
							</div>
						</div>
						<div class="clearfix"></div>
					</div>
				</nav>
				<!-- primary menu -->
				<nav class="navbar navbar-fixed-top navbar-default">
					<div class="container">
						<!-- Brand and toggle get grouped for better mobile display -->
						<div class="navbar-header">
							<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
								<span class="sr-only">Toggle navigation</span>
								<span class="icon-bar"></span>
								<span class="icon-bar"></span>
								<span class="icon-bar"></span>
							</button>
							<!-- logo area -->
							<a class="navbar-brand" href="index.html">
								<h4>Binh Coin</h4>
								<!-- logo image -->
								<img class="img-responsive"  alt="" />
							</a>
						</div>

						<!-- Collect the nav links, forms, and other content for toggling -->
						<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
							<ul class="nav navbar-nav navbar-right">
								<li><a href="index.html">Block Chain Explorer</a></li>
								<li><a href="#createwallet" data-toggle="modal" data-target="#createwallet">Create Wallet</a></li>
								<li><a href="#accesswallet" data-toggle="modal" data-target="#accesswallet">Access Wallet</a></li>
							</ul>
						</div><!-- /.navbar-collapse -->
					</div><!-- /.container-fluid -->
				</nav>
			</header>
			<!--/ header end -->
			
			<!-- banner area -->
			<div class="banner">
				<div id="carousel-example-generic" class="carousel slide" data-ride="carousel">
					<!-- Wrapper for slides -->
					<div class="carousel-inner" role="listbox">
						<div class="item active">
							<img src="img/banner/blockchain3.jpg" alt="...">
							<div class="container">
								<!-- banner caption -->
								<div class="carousel-caption slide-one">
									<!-- heading -->
									<h2 class="animated fadeInLeftBig"><i class="fa fa-hand-o-right "></i> Cryptocurrency For You!</h2>
									<!-- paragraph -->
									<h3 class="animated fadeInRightBig">Sending &amp; Mining reward</h3>
									<!-- button -->
									<a  class="animated fadeIn btn btn-theme" data-toggle="modal" data-target="#createwallet">Create Wallet</a>
									<a  class="animated fadeIn btn btn-theme" data-toggle="modal" data-target="#accesswallet">Access Wallet</a>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!--/ banner end -->
			
			<!-- block for animate navigation menu -->
			<div class="nav-animate"></div>
			
		<!-- block for animate navigation menu -->
        <div class="nav-animate"></div>
			
        <!-- Hero block area -->
        <div id="blockchainexplorer" class="hero pad">
                <div class="container">
                    <!-- hero content -->
                    <div class="hero-content ">
                        <div class="container d-flex justify-content-space-between">
                            <div >
                                <div class="card p-3">
                                    <p class="text-dark">Wallet</p>
                                    <div class="card-bottom pt-3 px-3 mb-2">
                                        <div class="d-flex flex-row justify-content-between text-align-center">
                                            <div class="d-flex flex-column"><span>Balance amount:</span>
                                                <p>&dollar; <span id="walletBalance" class="text-white">0</span></p>
                                            </div> 
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <hr>
                        <!-- heading -->
                        <h2>Your Transaction</h2>
                    </div>
                    <!-- hero play list -->
                    <div class="hero-block">
                        <div class="row">
                            <div class="col-md-6 col-sm-6">
                                <div class="card card-wrapper">
                                    <div class="card-header">
                                        <h4>Sending transaction</h4>
                                        <hr>
                                    </div>
                                    <div class="card-body">
                                        <!-- play list -->
                                        <div class="block-content force-overflow scroll-custom block-scroll-action">
                                            <table id="sendingTxs_table" class="table table-striped table-bordered" style="width:100%">
                                                <thead>
                                                    <tr>
                                                        <th>#</th>
                                                        <th>To</th>
                                                        <th>Amount</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="sendingTxs_body_container">
                                                    
                                                </tbody>
                                                
                                            </table>	
                                            <div id="sendingTxs_responseTotalTxs">

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 col-sm-6">
                                <div class="card card-wrapper">
                                    <div class="card-header">
                                        <h4>Receiving transaction</h4>
                                        <hr>
                                    </div>
                                    <div class="card-body">
                                        <!-- play list -->
                                        <div class="block-content force-overflow scroll-custom block-scroll-action">
                                            <table id="receivingTxs_table" class="table table-striped table-bordered" style="width:100%">
                                                <thead>
                                                    <tr>
                                                        <th>#</th>
                                                        <th>From</th>
                                                        <th>Amount</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="receivingTxs_body_container">
                                                    
                                                </tbody>
                                                
                                            </table>	
                                            <div id="receivingTxs_responseTotalTxs">

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--/ hero end -->
		
			
			<!-- meet -->
			<div class="meet parallax-four pad" id="meet">
				<div class="container">
					<!-- default heading -->
					<div class="default-heading-shadow">
						<h2>Upcoming Meets</h2>
					</div>
					<!-- meet location image -->
					<div class="meet-map">
						<img class="img-responsive img-map" src="img/flat/map.png" alt="" />
						<!-- map marker for India  -->
						<a href="#" class="map-marker india " data-toggle="tooltip" data-placement="top" title="India"><img class="img-responsive" src="img/flat/map-marker.png" alt="" /></a>
						<!-- map marker for United States  -->
						<a href="#" class="map-marker usa " data-toggle="tooltip" data-placement="top" title="United States"><img class="img-responsive" src="img/flat/map-marker.png" alt="" /></a>
						<!-- map marker for South Africa  -->
						<a href="#" class="map-marker sa " data-toggle="tooltip" data-placement="top" title="South Africa"><img class="img-responsive" src="img/flat/map-marker.png" alt="" /></a>
						<!-- map marker for Russia  -->
						<a href="#" class="map-marker russia " data-toggle="tooltip" data-placement="top" title="Russia"><img class="img-responsive" src="img/flat/map-marker.png" alt="" /></a>
						<!-- map marker for Brazil  -->
						<a href="#" class="map-marker brazil " data-toggle="tooltip" data-placement="top" title="Brazil"><img class="img-responsive" src="img/flat/map-marker.png" alt="" /></a>
					</div>
				</div>
			</div>
			<!-- meet end -->
			

			<!-- footer -->
			<footer>
				<div class="container">
					<!-- social media links -->
					<div class="social">
						<a class="h-facebook" href="#"><i class="fa fa-facebook"></i></a>
						<a class="h-google" href="#"><i class="fa fa-google-plus"></i></a>
						<a class="h-linkedin" href="#"><i class="fa fa-linkedin"></i></a>
						<a class="h-twitter" href="#"><i class="fa fa-twitter"></i></a>
					</div>
					<!-- copy right -->
					<p class="copy-right">&copy; copyright 2018, All rights are reserved.</p>
				</div>
			</footer>
			<!-- footer end -->
			
			<!-- Scroll to top -->
			<span class="totop"><a href="#"><i class="fa fa-chevron-up"></i></a></span> 
		</div>
		
		<!-- Javascript files -->
		
		<!-- jQuery -->
		<script src="js/jquery.js"></script>
		<script src="js/jquery.mCustomScrollbar.js"></script>	
		<!-- Bootstrap JS -->
		<script src="js/bootstrap.min.js"></script>
		<!-- WayPoints JS -->
		<script src="js/waypoints.min.js"></script>
		<!-- Include js plugin -->
		<script src="js/owl.carousel.min.js"></script>
		<!-- One Page Nav -->
		<script src="js/jquery.nav.js"></script>
		<!-- Respond JS for IE8 -->
		<script src="js/respond.min.js"></script>
		<!-- HTML5 Support for IE -->
		<script src="js/html5shiv.js"></script>
		<!-- Custom JS -->
		<script src="js/custom.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.7.7/handlebars.min.js"></script>
		<script>
			let ts = 0;
			window.onload = initWalletAccessing();
			function initWalletAccessing(){
                console.log("test");
				loadWalletInfo();
				setInterval(() => {
					loadWalletBalance();
				}, 5000);
			}
			function loadWalletBalance() { 
				let currentUrlString = window.location.href;
				let currentUrl = new URL(currentUrlString);
				let address = currentUrl.searchParams.get("address");
				const url = 'http://localhost:3001/balance'+"/"+address.toString();
				axios.get(url).then(function (res) {
					console.log(res.data);
					document.getElementById("walletBalance").innerHTML = '';
					document.getElementById("walletBalance").innerHTML = res.data.balance;
				}).catch(function (err) {  
					console.log(err);
				});
			};
			function loadWalletInfo() {
				let currentUrlString = window.location.href;
				let currentUrl = new URL(currentUrlString);
				let address = currentUrl.searchParams.get("address");
				console.log(currentUrl.searchParams.get("address"));
				
				const urlWalletTransactions = 'http://localhost:3001/transactions' + '/' + address.toString();
				axios.get(urlWalletTransactions).then(function(res){
					
					if(res.data.sendingTxs.length!=0){
						let i=0;
						for (f of res.data.sendingTxs) {
							const tr = `<tr >
										<th scope="row">${i}</th>
										<td class="value-toAddress-text"><a href="walletdetail.html?address=${f.toAddress}" class="value-block-text">${f.toAddress}</a></td>
										<td>${f.amount}</td>
									</tr>`;
								$('#sendingTxs_body_container').append(tr);
							i+=1;
						}

						$('#sendingTxs_table').DataTable();
					}
					else{
						document.getElementById("sendingTxs_responseTotalTxs").innerHTML = "This wallet doesnot create any transactions";
					}
					if(res.data.receivingTxs.length!=0){
						let i=0;
						for (f of res.data.receivingTxs) {
							let fromAddress =  f.fromAddress?f.fromAddress:"system";
							const tr = `<tr >
										<th scope="row">${i}</th>
										<td class="value-toAddress-text"><a href="wallet.html?address=${fromAddress}" class="value-block-text">${fromAddress}</a></td>
										<td>${f.amount}</td>
									</tr>`;
								$('#receivingTxs_body_container').append(tr);
							i+=1;
						}

						$('#receivingTxs_table').DataTable();
					}
					else{
						document.getElementById("receivingTxs_responseTotalTxs").innerHTML = "This wallet doesnot create any transactions";
					}
				});
			}
		</script>
		
        <script>
			
			function createWallet(){
				const createWalletUrl = 'http://localhost:3001/create-wallet';
				axios.post(createWalletUrl).then(function (res) { 
					console.log(res.data);
					var file = new File([JSON.stringify(res.data)], "WalletKey.txt", {type: "text/plain;charset=utf-8"});
					saveAs(file);
				})
			};
			function accessWallet(){
				const createWalletUrl = 'http://localhost:3001/access-wallet';
				axios.post(createWalletUrl,{
					privateKey: document.getElementById('private-key').value,
				}).then(function (res) { 
					let currentUrlString = window.location.href;
					let currentUrl = new URL(currentUrlString);
					console.log(currentUrl.origin);
					window.location.href = currentUrl.origin + "/wallet.html?address="+res.data; 
				}).catch(function (error) {
					console.log(error);
				});
			}
		</script>
	</body>	
</html>